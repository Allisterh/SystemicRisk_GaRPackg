
```{r import_data, child="GaR-ImportAndProcessData.Rmd"}

```


```{r Set_partitions, child="Partition-Specs.Rmd"}

# source("Partition-Specs.R",echo = FALSE)

current_partitions_list = partitions_list[!names(partitions_list) %in%
                                            "extensive"]


```


```{r lasso}

temp_df = df %>% 
  select(Date,names(df)[names(df) %in% unlist(partitions_list$basic_no_global_inf)]) %>% 
  as.data.frame() %>% 
  mutate(across(-Date,scale)) %>% 
  add_leads_to_target_var(
    target_var_name = "GDP",
    leads_vector = parameters_list$horizon_list)

lasso_df = temp_df %>% 
  select(-contains("GDP"), GDP, GDP_4) %>% 
  filter(complete.cases(.))

x_mat = lasso_df %>% 
  select(-GDP_4, -Date) %>% 
  as.matrix()

y_vec = lasso_df$GDP_4 %>% 
  as.matrix()

lasso_reg_list = map(seq(0,1,2),function(temp_lambda){
  temp_reg = rq.fit.lasso(
    x = x_mat,
    y = y_vec,
    tau = 0.05,
    lambda = temp_lambda)
  
  return(temp_reg)
  
  
})

```


```{r plot_lasso_coefs}

lasso_coef %>% 
  filter(lambda %in% c(0,1,2)) %>% 
  ggplot(aes(x = reorder(var,abs(coef)), y = coef)) + 
  geom_col() + 
  xlab(NULL) + ylab(NULL) + 
  facet_wrap(~lambda, scales = "free") + 
  coord_flip()

```



