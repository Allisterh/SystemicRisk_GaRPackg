---
title: "GaR analysis"
bibliography: C:\\Users\\internet\\Documents\\Refrences\\GaR.bib
fontsize: 11pt
output:
  rmarkdown::pdf_document:
    latex_engine: xelatex
    number_sections: true
    includes:
            in_header: C:\\Users\\internet\\Documents\\GaRpckg\\GaR-preamble.tex

vignette: >
  %\VignetteIndexEntry{GaR analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF_8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, echo = FALSE, message = FALSE,warning = FALSE,
  comment = "#>"
)
```


```{r setup}

devtools::load_all()

library(GaRPackg)

# setwd("C:\\Users\\Misha\\Documents\\GaRPackg\\vignettes")
```


```{r load_libraries}

library(cowplot)

library(gghighlight)

library(tidyselect)

library(tidyverse)

library(quantreg)

library(corrplot)

library(stargazer)

library(xtable)

```


```{r Import_data}

raw_data = list(osnat_list = import.osnat.data(),
                michael_list = import.michael.data())

raw_data$raw_df = full_join(raw_data$osnat_list$osnat_df,
                            raw_data$michael_list$michael_df,
                            by = "Date") %>% 
  arrange(Date)

```


```{r Set_parameters}

setwd("C:\\Users\\internet\\Documents\\GaRpckg\\vignettes")


results = list()

parameters_list = list()

parameters_list$quantile_vec = c(0.05,0.25,0.5,0.75,0.95)

parameters_list$horizon_list = list(1,8,12)

parameters_list$drop_series = c("Vacancies_Rate","Telbor_1Y","STARTUP_FP",
                "Sovereigh_spread",
                "Interbank_spread","LT_real_rate_change",
                "TA125_Close","Indus_prod_ind","ILS_EURO",
                "breakeven_inflation_5_10_fwd")


```


```{r Set_partitions}

source("Partition-Specs.R",echo = FALSE)

current_partition = partitions_list$OZMG

```


```{r Process_data}

vars_to_rates = c("Ind_Prod_advanced","Ind_Prod_Israel",
                  "GDP_F","C_FP","G_NDEFIMP_FP","INV_FP",
                  "INV_NI_FP","EXP_ND_FP","IMP_ND_FP","STARTUP_FP",
                  "CPI_season_adj","CPI_no_house_fruits_season_adj",
                  "CPI_no_house_season_adj","CPI", "CPI_no_house",
                  "CPI_no_fruits","ILS_USD","ILS_EURO","ILS_Yen","ILS_GBP",
                  "gdp_us","gdp_euro","gdp_japan","gdp_uk",
                  "Brent","Commodity_Non_Energy","Labor_pop",
                  "Wage","EMP","Labor_force","Tourists","TA125_Close",
                  "Avg_House_Price_index","Credit_to_non_fin_sector",
                  "IMP_OECD")

df = raw_data$raw_df %>% 
  select(-GDP_F, -GDP_no_tax,-GDP_season_adj) %>% 
  rename(GDP_F = GDP_no_startup)

# Normalize CA by GDP

df = df %>% 
  mutate(CA = CA / GDP_F)


# Transform variables to rates of change YoY

df = df %>% 
  mutate_at(vars(vars_to_rates),
            .funs = list(~./lag(.,4)-1))


# Calculate difference

df = df %>%
  mutate(real_rate_2_3_fwd = real_rate_2_3_fwd - real_rate_5_10_fwd) %>%
  mutate(BOI_rate = BOI_rate - real_rate_5_10_fwd) %>%
  mutate(US_5 = US_5 - US_10) %>%
  mutate(EU_5 = EU_5 - EU_10) %>%
  mutate(JPN_5 = JPN_5 - JPN_10) %>%
  mutate(Ger_5 = Ger_5 - Ger_10) %>%
  mutate(UK_5 = UK_5 - UK_10) %>%
  mutate(rate_us = rate_us - US_10) %>%
  mutate(rate_euro = rate_euro - EU_10) %>%
  mutate(rate_japan = rate_japan - JPN_10) %>%
  mutate(rate_uk = rate_uk - UK_10) %>%
  select(-ends_with("10"))

# Filter df

df = df %>% 
  select(-!!(parameters_list$drop_series))


```


```{r Analysis}

results = run.GaR.analysis(partitions_list = current_partition,
                   vars_df = df %>% 
                     mutate(Spread_CPI_corp = -1 * Spread_CPI_corp),
                   horizon_list = parameters_list$horizon_list,
                   quantile_vec = parameters_list$quantile_vec)


```


\section{Literature review}

```{r child="GaR-LitReview.Rmd",eval=FALSE}

```


\section{PCA results}

```{r plot_pca, child="GaR-Partition-Evaluation.Rmd",eval=FALSE}


```


\section{Quantile regression results}

```{r plot_quantile_reg, child="GaR-Quantile-Regression.Rmd",eval=FALSE}

```


\section{Stylized facts}

```{r child="GaR-StylizedFacts.Rmd",eval=FALSE}

```


\section{GaR timeseries}

```{r plot_gar, child="GaR-Timeseries.Rmd",eval=FALSE}

```

\section{Robustness}

```{r compare_predictions, child="GaR-Prediction-Comparison.Rmd"}

```



\section{Bibliography}

<div id="refs"></div>


\section {Appendix}

```{r child="GaR-Appendix.Rmd"}

```


```{r child="GaR-Variables-Desc-Chart.Rmd"}

```


