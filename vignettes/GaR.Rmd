---
title: "GaR analysis"
output:
  rmarkdown::pdf_document:
    latex_engine: xelatex
    number_sections: true
    includes:
            in_header: C:\\Users\\Misha\\Documents\GaR\\GaR-preamble.tex

vignette: >
  %\VignetteIndexEntry{GaR analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF_8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, echo = FALSE, message = FALSE,warning = FALSE,
  comment = "#>"
)
```


```{r setup}

devtools::load_all()

library(GaRPackg)

```


```{r load_libraries}

library(cowplot)

library(gghighlight)

library(tidyselect)

library(tidyverse)

library(quantreg)

library(rlang)

```


```{r Import_data}

raw_data = list(osnat_list = import.osnat.data(),
                michael_list = import.michael.data())

raw_data$raw_df = full_join(raw_data$osnat_list$osnat_df,
                            raw_data$michael_list$michael_df,
                            by = "Date") %>% 
  arrange(Date)

```


```{r Set_parameters}

results = list()

parameters_list = list()

parameters_list$quantile_vec = c(0.05,0.25,0.5,0.75,0.95)

parameters_list$horizon_list = list(1,8,12)

parameters_list$drop_series = c("Vacancies_Rate","Telbor_1Y","STARTUP_FP",
                "Term_spread","Sovereigh_spread",
                "Interbank_spread","LT_real_rate_change",
                "TA125_Close","Indus_prod_ind","ILS_EURO",
                "breakeven_inflation_5_10_fwd")


```


```{r Process_data}


df = raw_data$raw_df %>% 
  select(-GDP_F, -GDP_no_tax,-GDP_season_adj) %>% 
  rename(GDP_F = GDP_no_startup)


```


```{r make_data_list}

data_list = list()

data_list$complete_cases_df = df %>%
  filter(complete.cases(.))

data_list$long_series_df = df %>% 
  select(-!!(parameters_list$drop_series))


data_list$interpolated_df = df %>%
  mutate_at(.vars = vars(-Date), interpolate)



```


```{r Analysis}

results$long_series = run.GaR.analysis(partitions_list = partitions,
                               vars_df = data_list$long_series_df,
                               horizon_list = parameters_list$horizon_list,
                               quantile_vec = parameters_list$quantile_vec)

# results$interpolated = run.GaR.analysis(partitions_list = partitions,
#                                vars_df = data_list$interpolated_df,
#                                horizon_list = parameters_list$horizon_list,
#                                quantile_vec = parameters_list$quantile_vec)



```

