---
title: "GaR analysis"
# bibliography: C:\\Users\\Misha\\Documents\\References\\GaR.bib
fontsize: 11pt
output:
  rmarkdown::pdf_document:
    latex_engine: xelatex
    number_sections: true
    includes:
            in_header: !expr here::here('vignettes/GaR-preamble.tex')

vignette: >
  %\VignetteIndexEntry{GaR analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF_8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, echo = FALSE, message = FALSE,warning = FALSE, comment = "#>"
)
```


```{r setup}

devtools::load_all()

setwd(paste0(file.path(Sys.getenv("USERPROFILE"),fsep = "\\"),
             "\\Documents\\GaRPackg\\vignettes"))


```


```{r load_libraries}

library(cowplot)

library(gghighlight)

library(tidyselect)

library(tidyverse)

library(quantreg)

library(corrplot)

library(stargazer)

library(xtable)

library(forcats)

```


```{r Get_partitions, child="Partition-Specs.Rmd"}

```


```{r import_data, child="GaR-ImportAndProcessData.Rmd"}

```

\section{Descriptive Stats}

```{r desc_stat, child="GaR-DescriptiveStat.Rmd", eval=FALSE}

```



```{r rename_vars, eval=FALSE}

rename_list = list(old_names = c("GDP_F","Ind_Prod_Israel",
                                 "Ind_Prod_advanced","ILS_USD_spread_pct",
                                 "TA_35_impl_vol","ILS_USD_impl_vol",
                                 "Credit",
                                 "House_Price"),
                   new_names = c("GDP","Ind_Prod","IP_adv",
                                 "FX_spread","VIX_TA",
                                 "FX_imp_vol","Credit","HousePrice"))

existing <- match(rename_list$old_names,names(df))

names(df)[na.omit(existing)] <- rename_list$new_names[which(!is.na(existing))]


current_partition = lapply(current_partition, function(temp_part){
  
  lapply(temp_part, function(temp_name){
  
  ind = which(rename_list$old_names == temp_name)
  
  if(length(ind) == 0){
    
    return(temp_name)
    
  } else {
    
    
    return(rename_list$new_names[ind])
    
  }
  
  
  return(rename_list$new_names[])
  
  
})


})


```



```{r Analysis}

current_partition = partitions_list$basic

results = run.GaR.analysis(partitions_list = current_partition,
                   vars_df = df,
                   target_var_name = "GDP",
                   horizon_list = parameters_list$horizon_list,
                   quantile_vec = parameters_list$quantile_vec,
                   pca.align.list = list(
                     Dom_FCI = list(
                       var_name = "Spread_CPI_corp",
                       positive_direction = FALSE),
                     Dom_Macro = list(var_name = "GDP"),
                     Global = list(var_name = "rate_euro"),
                     FinCycle = list(var_name = "Credit")))


```


```{r Nowcast, eval=FALSE}

nowcast_results = run.GaR.analysis(
  partitions_list = current_partition,
  vars_df =  df %>% 
    mutate(across(c("Credit","House_Price"), interpolate)),
  horizon_list = parameters_list$horizon_list,
  quantile_vec = parameters_list$quantile_vec,
  pca.align.list = list(Dom_FCI = list(
    var_name = "Spread_CPI_corp",
    positive_direction = FALSE)))

```


\section{Literature review}

```{r child="GaR-LitReview.Rmd", eval=FALSE}

```


\section{PCA results}

```{r plot_pca, child="GaR-Partition-Evaluation.Rmd"}


```


\section{Quantile regression results}

```{r plot_quantile_reg, child="GaR-Quantile-Regression.Rmd"}

```


\section{Stylized facts}

```{r child="GaR-StylizedFacts.Rmd"}

```


\section{GaR timeseries}

```{r plot_gar, child="GaR-Timeseries.Rmd"}

```

\section{Robustness}

```{r compare_predictions, child="GaR-Prediction-Comparison.Rmd"}

```



\section{Bibliography}

<div id="refs"></div>


\section {Appendix}

```{r child="GaR-Appendix.Rmd", eval=FALSE}

```


```{r child="GaR-Variables-Desc-Chart.Rmd", eval=FALSE}

```


