
```{r calculate_goodness_of_fit_scores}

forecast_parameters = list(win_len = 40, win_type_expanding = TRUE)

gar_df = get_gar_forecast(
  partitions_list = current_partition,
  vars_df = df,
  target_var_name = "gdp",
  horizon_list = parameters_list$horizon_list,
  quantile_vec = parameters_list$quantile_vec,
  win_len = forecast_parameters$win_len,
  win_type_expanding = forecast_parameters$win_type_expanding) %>% 
  rename(forecast_values = gar_forecast)


benchmark_df = get_gar_forecast(
  partitions_list = NULL,
  vars_df = df,
  target_var_name = "gdp",
  horizon_list = parameters_list$horizon_list,
  quantile_vec = parameters_list$quantile_vec,
  win_len = forecast_parameters$win_len,
  win_type_expanding = forecast_parameters$win_type_expanding) %>% 
  rename(benchmark_values = gar_forecast)

temp = gar_df %>% 
  left_join(benchmark_df,by = c("quantile", "horizon", "date")) %>% 
  left_join(df %>% select(gdp, date), by = "date")


r2_df = temp %>% 
  group_by(quantile, horizon) %>% 
  summarise(r2 = quantile_r2_score(realized_values = gdp,
                    forecast_values = forecast_values,
                    benchmark_values = benchmark_values,
                    quantile = as.numeric(quantile[1])), .groups = "drop"
)

pit_df = temp %>% 
  select(horizon, quantile, date, gdp, forecast_values) %>% 
  rename(actual_values = gdp, predicted_values = forecast_values) %>% 
  quantile_pit_score()

```


```{r plot_r2_goodness_of_fit}

r2_df %>% 
  mutate(horizon = factor(horizon, c(1,4,8,12))) %>% 
  ggplot(aes(x = quantile, y = r2)) + 
  geom_col() + 
  facet_wrap(~horizon) + 
  xlab(NULL) + ylab(NULL)

```



```{r plot_pit_goodness_of_fit}

pit_df %>% 
  mutate(horizon = factor(horizon, c(1,4,8,12))) %>% 
  ggplot(aes(x = as.numeric(quantile), y = pit, group = 1)) + 
  geom_line(color = "blue") +
  geom_abline(slope = 1,intercept = 0, linetype = "dashed") + 
  facet_wrap(~horizon) + 
  xlab(NULL) + ylab(NULL)

```

