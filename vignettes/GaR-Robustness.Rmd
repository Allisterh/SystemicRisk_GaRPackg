
```{r import_data, child="GaR-ImportAndProcessData.Rmd"}

```



```{r get_all_combinations_test}

category_list = list(
  Dom_Macro = list(
  optional = c("state_of_economy_ind","ue_gap"),
  required = c("GDP")),
  Global = list(
  optional = c("rate_us","rate_euro",
                "US_term_spread","SP500","eurostoxx600",
                "VIX","oecd_imp","oil_p","non_energy_p"),
  required = c("gdp_us","gdp_euro")),
  Fin_cycle = list(
  optional = c("TA125_Close","House_Price"),
  required = c("Credit")),
    Dom_FCI =  list(
      required = c(
        "Spread_CPI_corp",
        "Sovereigh_spread",
        "Term_spread",
        "ILS_USD_impl_vol",
        "TA_35_impl_vol",
        "BOI_rate"))
  )

category_params_df =  %>% 
  enframe(name = "category",value = "params") %>% 
  mutate(part_comb_df = map2(category,params,function(x,y){
    
    temp_part_df = get_partition_combs(
      optional_vars_vec = y$optional,
      required_vars_vec = y$required,
      partition_name = x)

  }))


# feature_select_df = map(
#   category_params_df$category,function(temp_cat){
#     
#     temp_df = category_params_df %>% 
#       filter(category == temp_cat) %>% 
#       select(part_comb_df) %>% 
#       unnest(cols = c(part_comb_df))
#     
#     return(temp_df)
#                           
#                         }
#   ) %>% 
#   reduce(full_join, by = character()) %>% 
#   unite(col = name,starts_with("name"),sep = "-") %>% 
#   mutate(Fin = map(1:nrow(.),~fixed_parts)) %>% 
#   mutate(temp_part = pmap(list(Dom_Macro,Global,Fin), c))

rm(fixed_parts)



feature_select_df = map(
  category_params_df$category,function(temp_cat){
    
    temp_df = category_params_df %>% 
      filter(category == temp_cat) %>% 
      select(part_comb_df) %>% 
      unnest(cols = c(part_comb_df))
    
    return(temp_df)
                          
                        }
  ) %>% 
  reduce(full_join, by = character()) %>% 
  unite(col = name,starts_with("name"),sep = "-")

```


```{r get_predictions}


pred_df = feature_select_df %>% 
  slice_sample(1000) %>% 
  mutate(pred_df = map(temp_part,get.gar.forecast,
                       vars_df = df,
                       target_var_name = "GDP",
                       horizon_list = parameters_list$horizon_list,
                       quantile_vec = parameters_list$quantile_vec
  ))



```

